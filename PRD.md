# 제품 요구사항 정의서 (PRD): 한화 이글스 라인업 최적화 시스템

## 1. 개요 (Introduction)
본 프로젝트는 **한화 이글스 라인업 최적화 시스템**을 구축하는 것을 목표로 합니다. 몬테카를로 시뮬레이션 또는 마르코프 체인 방법론을 활용하여, 1번부터 9번까지의 타순 변경이 팀의 기대 득점(Expected Runs)과 승리 확률에 미치는 영향을 정량화합니다. 이를 통해 현장 코칭 스태프의 데이터 기반 의사결정을 지원하는 최적의 라인업을 제안합니다.

## 2. 문제 정의 (Problem Statement)
- **핵심 질문**: "1번부터 9번까지 타순을 바꾸면 득점 기대값이 얼마나 달라지는가?"
- **현재의 한계**: 기존의 라인업 결정은 직관이나 전통적인 스탯에 의존하는 경향이 있습니다. 라인업 구성이 실제 득점력에 미치는 영향을 수치로 시뮬레이션하고 비교할 수 있는 도구가 필요합니다.

## 3. 목표 (Objectives & Goals)
1.  **정량적 비교**: 현재 라인업 vs 제안된 최적 라인업의 '기대 득점(XR)'과 '승리 확률'을 계산하여 비교 제시합니다.
2.  **시나리오 기반 최적화**: 상대 투수 유형(좌투/우투/구종 등)에 따른 맞춤형 플래툰 라인업을 추천합니다.
3.  **직관적 시각화**: 복잡한 시뮬레이션 데이터를 모바일 친화적인 고품질 대시보드로 시각화하여, 코칭 스태프가 즉각적으로 이해하고 활용할 수 있도록 합니다.

## 4. 타겟 사용자 (Target Audience)
- **주 사용**: 코칭 스태프 (감독, 타격 코치) - 경기 전략 수립 및 대타 결정 지원.
- **보조 사용**: 전력분석팀 - 시뮬레이션 모델 검증 및 데이터 분석.
- **기타**: 팬 - 심화 데이터(Saber Metrics)에 관심 있는 야구 팬층.

## 5. 범위 (Scope - MVP)

### 5.1. 시뮬레이션 엔진 (Simulation Engine)
- **방법론**:
    - **1단계 (기본)**: 타자별 출루율(OBP), 장타율(SLG), 타율(Avg)을 기반으로 한 몬테카를로 시뮬레이션.
    - **2단계 (고급)**: 베이스 상황별 전이 확률(Transition Probabilities)을 반영한 마르코프 체인 모델.
- **입력 데이터**:
    - 한화 이글스 선수 로스터 및 스탯.
    - 상대 투수 유형 (좌/우).
- **출력 데이터**:
    - 9이닝 당 기대 득점 분포.
    - 승리 확률(%).

### 5.2. 사용자 인터페이스 (Dashboard Design)
제공된 디자인 컨셉(`stitch_.zip`)을 기반으로 다음과 같은 UI를 구현합니다:

#### A. 헤더 및 컨텍스트
- **테마**: 다크 모드 기반, 한화 이글스 아이덴티티 컬러 적용 (오렌지 `#f37321`, 블루 `#137fec`, 다크 배경 `#111a22`).
- **정보 표시**: 시뮬레이션 ID, 일시, 상대 팀 정보 등.

#### B. 핵심 지표 카드 (Key Metrics)
- **승리 확률 (Win Probability)**: 대형 퍼센트 표시 및 증감(Delta) 표기 (예: `60.5% (+12.5% vs 현재)`).
- **기대 득점 (Expected Runs)**: 예상 득점 수치 및 증감 표기 (예: `5.1점 (+0.9 vs 현재)`).
- **시각적 신호**: 긍정적 변화를 나타내는 상승 화살표(초록색) 등 사용.

#### C. 데이터 시각화 (Charts & Visuals)
- **승리 확률 그래프**: 9이닝 동안의 승리 확률 변화 추이. '현재 라인업(회색 점선)'과 '최적 라인업(파란색 그라데이션)' 비교.
- **필드 시각화 (Field Visualizer)**: 야구장 다이아몬드 그래픽 위에 선택된 라인업의 수비 위치(P, C, 1B 등) 시각화.

#### D. 인터랙티브 라인업 관리 (Lineup Management)
- **토글 스위치**: '현재 라인업(Current)'과 '최적 라인업(Optimized)' 간빠른 전환 기능.
- **타순 리스트 (1-9번)**:
    - **타순**: 1~9번 번호 표시.
    - **선수 카드**: 프로필 이미지(또는 플레이스홀더), 이름, 포지션 배지(2B, RF 등).
    - **스탯 정보**: 타석 위치(좌/우), 핵심 스탯(타율, 홈런, 타점 등).
    - **기여도 지표**: 해당 타순에서의 예상 OPS 또는 기여도 수치.
    - **강조 표시**: 핵심 키플레이어 또는 뜨거운 타자(`Fire` 아이콘) 강조.

#### E. 액션 (Actions)
- **다시 돌리기 (Rerun)**: 파라미터를 조정하여 시뮬레이션을 다시 실행.
- **라인업 적용 (Apply Lineup)**: 최종 라인업을 확정하거나 공유/내보내기.

### 5.3. 데이터 아키텍처 및 수급 계획 (Data Strategy)

#### 1) 필수 수집 데이터 항목 (Data Requirements)
시뮬레이션 엔진(마르코프 체인 및 몬테카를로) 가동을 위해 필요한 데이터셋입니다.

| 분류 | 데이터 항목 | 용도 |
| :--- | :--- | :--- |
| **선수 기본** | 이름, 등번호, 포지션, 투타(좌/우/양) | UI 표시 및 라인업 구성 |
| **타격 지표** | 타율(AVG), 출루율(OBP), 장타율(SLG), OPS | 1단계(기본) 시뮬레이션 |
| **상황 확률** | 단타, 2루타, 3루타, 홈런, 볼넷, 삼진, 병살타 확률 | 2단계(고급) 마르코프 체인 전이 확률 계산 |
| **상대 투수** | 투수 유형(좌/우/언더), 해당 유형 상대 성적 | 플래툰 최적화 및 시나리오 생성 |

#### 2) 데이터 수급 경로 (Data Sources)
- **Primary (자동)**: Statiz(스탯티즈) - 세이버메트릭스 및 상황별 성적 상세 데이터 추출.
- **Secondary (보조)**: KBO 공식 기록실 - 실시간 로스터 변경 및 공식 기록 검증.
- **Manual (수동)**: 부상자 명단, 당일 컨디션 등 정성적 데이터 (관리자 UI에서 입력).

#### 3) 데이터 파이프라인 (Data Pipeline)
데이터를 시스템에 불러오는 프로세스입니다.
1.  **Collection**: Python(BeautifulSoup/Selenium) 기반 크롤러가 매일 자정 또는 경기 직전 데이터를 수집합니다.
2.  **Preprocessing**: 수집된 원천 데이터를 시뮬레이션에 필요한 전이 확률(Probability Matrix) 형태로 가공합니다.
    - 예: `P(Single) = Single / Plate Appearances`
3.  **Storage**: 가공된 데이터를 `players_data.json` 형태의 경량 데이터로 저장하여 프론트엔드 엔진에 전달합니다.
4.  **Application**: 프론트엔드(JavaScript) 시뮬레이터가 JSON 데이터를 로드하여 10,000회 연산을 수행합니다.

## 6. 기능 요구사항 (Functional Requirements)
1.  **데이터 로드**: 현재 한화 이글스 로스터 및 최신 시즌 스탯 데이터 로딩.
2.  **시뮬레이션 실행**: 지정된 라인업으로 `N`회(예: 10,000회) 게임을 시뮬레이션하여 결과 생성.
3.  **최적화 알고리즘**: 타순을 변경(Permutation)하며 기대 득점이 최대화되는 조합 탐색.
4.  **결과 렌더링**: 시뮬레이션 결과를 대시보드 UI에 반영.

## 7. 기술 스택 (Technical Stack)
- **Frontend**: HTML5, Tailwind CSS (Vanilla 권장).
- **Design System**: 커스텀 컬러 팔레트(한화 오렌지/블루), Material Symbols 아이콘, Google Fonts (Lexend, Noto Sans KR).
- **Logic**: JavaScript (MVP 단계에서는 클라이언트 사이드 시뮬레이션) 또는 Python (추후 고도화 시 백엔드 연동).

### 7.3. 연산 효율성 최적화 전략 (Performance Optimization)
**문제**: 9! (362,880가지) 라인업에 대해 각 10,000회 시뮬레이션을 수행하는 것은 클라이언트 성능 한계를 초과하여 UI 프리징(Blocking)을 유발할 수 있습니다.
**해결 방안**:
1.  **유전 알고리즘 (Genetic Algorithm) 도입**:
    -   전수 조사 대신 국소 최적해(Local Optima)를 빠르게 탐색하여 연산량 대폭 감소 (약 1,000회 시뮬레이션).
2.  **비동기 루프 처리 (Non-blocking)**:
    -   `Optimizer`의 세대 진화 루프 내에 `setTimeout(..., 0)` 패턴을 적용하여, 연산 중간에 메인 스레드 제어권을 UI에 양보함으로써 화면 멈춤 현상 방지.
3.  **초기화 최적화**: 앱 시작 시에는 시뮬레이션을 수행하지 않고 현재 라인업만 렌더링하도록 지연 실행(Lazy Execution) 적용.

### 7.4. 시뮬레이션 정교화 모델링
1.  **주자 상황별 전이 확률 (Context-Aware Transition)**:
    -   단순 '안타' 확률이 아닌, `P(1루 주자 3루 진루 | 우전 안타)`와 같이 세분화된 주루 데이터를 반영.
2.  **구장 효과 (Park Factor)**:
    -   대전 한화생명 이글스파크(홈) vs 잠실(원정) 등 구장별 득점 성향 보정치 적용 기능 추가.

### 7.5. [Advanced Feature] 실시간 대타 시뮬레이터 (Live Sub Simulator)
-   경기 중반(6~7회) 특정 상황에서 대타 투입 시 승리 확률 변화(Win Probability Added, WPA)를 즉석에서 계산.
-   코칭 스태프의 '대타 작전' 의사결정을 실시간 지원하는 기능.

## 8. 성공 지표 (Success Metrics)
- **정확성**: 시뮬레이션 결과가 실제 팀의 득점 분포와 유사한 경향성을 보이는가.
- **직관성 (Usability)**: 사용자가 대시보드 진입 후 5초 이내에 "더 나은 라인업"이 무엇인지 파악 가능한가.
- **성능**: 시뮬레이션 및 결과 렌더링이 2초 이내에 완료되는가.

## 9. 디자인 참조 (Design Reference)
- **파일**: `stitch_.zip` (압축 해제된 `design/` 폴더)
- **주요 화면**:
    - `code.html`: 메인 대시보드 뷰.
    - `screen.png`: 비주얼 레퍼런스 이미지.

---
*Drafted by Antigravity*
